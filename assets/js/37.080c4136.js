(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{422:function(s,a,t){"use strict";t.r(a);var n=t(8),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"写在文章开头"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#写在文章开头"}},[s._v("#")]),s._v(" 写在文章开头")]),s._v(" "),a("p",[a("code",[s._v("Arthas")]),s._v("是一款强大的开源"),a("code",[s._v("Java")]),s._v("诊断程序，它可以非常方便的启动并以界面式的方式和"),a("code",[s._v("Java")]),s._v("程序进行交互,支持监控程序的内存使用情况、线程信息、gc情况、甚至可以反编译并修改现上代码等。所以它成为笔者进行线上问题排查的重要手段，而本文将从实际使用的角度介绍一下"),a("code",[s._v("arthas")]),s._v("的基本使用技巧，希望对你有帮助。")]),s._v(" "),a("p",[s._v("我是 "),a("strong",[s._v("SharkChili")]),s._v(" ，Java 开发者，"),a("strong",[s._v("Java Guide")]),s._v(" 开源项目维护者。欢迎关注我的公众号："),a("strong",[s._v("写代码的SharkChili")]),s._v("，也欢迎您了解我的开源项目 mini-redis："),a("a",{attrs:{href:"https://github.com/shark-ctrl/mini-redis",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/shark-ctrl/mini-redis"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"arthas基础说明与配置演示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#arthas基础说明与配置演示"}},[s._v("#")]),s._v(" Arthas基础说明与配置演示")]),s._v(" "),a("h3",{attrs:{id:"arthas的运行原理-理解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#arthas的运行原理-理解"}},[s._v("#")]),s._v(" Arthas的运行原理(理解)")]),s._v(" "),a("p",[a("code",[s._v("arthas")]),s._v("的运行原理大致是以下几个步骤:")]),s._v(" "),a("ol",[a("li",[s._v("启动"),a("code",[s._v("arthas")]),s._v("选择目标"),a("code",[s._v("Java")]),s._v("程序后，"),a("code",[s._v("arthas")]),s._v("会向目标程序注入一个代理。")]),s._v(" "),a("li",[s._v("代理会创建一个集"),a("code",[s._v("HTTP")]),s._v("和"),a("code",[s._v("Telnet")]),s._v("的服务器与客户端建立连接。")]),s._v(" "),a("li",[s._v("客户端与服务端建立连接。")]),s._v(" "),a("li",[s._v("后续客户端需要监控或者调整程序都可以通过服务端"),a("code",[s._v("Java Instrumentation")]),s._v("机制和应用程序产生交互。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949964.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"下载安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载安装"}},[s._v("#")]),s._v(" 下载安装")]),s._v(" "),a("p",[s._v("文章开始前，我们需要先下载安装一下"),a("code",[s._v("Arthas")]),s._v("，"),a("code",[s._v("Arthas")]),s._v("的官方地址为:"),a("a",{attrs:{href:"https://arthas.aliyun.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://arthas.aliyun.com/"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("考虑到方便笔者一般是使用命令行的方式下载:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v(" https://arthas.aliyun.com/arthas-boot.jar\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("完成后我们通过下面jar命令将"),a("code",[s._v("Arthas")]),s._v("启动：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-jar")]),s._v(" arthas-boot.jar\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("此时我们就可以看到对应的进程序号和进程的pid，以笔者为例，开启"),a("code",[s._v("arthas")]),s._v("之后就会看到一个序号为1的"),a("code",[s._v("9121")]),s._v("的"),a("code",[s._v("Java")]),s._v("进程，我们可以直接点击1并输入回车对此进程进行监控管理：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" JAVA_HOME: /usr/lib/jvm/java-8-openjdk-amd64/jre\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" arthas-boot version: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.7")]),s._v(".2\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Found existing "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v(" process, please choose one and input the serial number of the process, eg "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". Then hit ENTER.\n* "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9121")]),s._v(" arthasExample.jar\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("随后"),a("code",[s._v("arthas")]),s._v("初次会进行相关依赖下载，然后我们就可以正式的使用"),a("code",[s._v("arthas")]),s._v("管理当前进程了：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949087.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"离线用户的使用姿势-可选阅读"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#离线用户的使用姿势-可选阅读"}},[s._v("#")]),s._v(" 离线用户的使用姿势(可选阅读)")]),s._v(" "),a("p",[s._v("考虑到内网用户无法联网进行"),a("code",[s._v("arthas")]),s._v("初始化，所以"),a("code",[s._v("arthas")]),s._v("也人性化的提供了全量包的下载方式，有需要的读者可移步到下载页面选择全量包下载即可获取全量的"),a("code",[s._v("arthas")]),s._v("包：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949254.png",alt:""}})]),s._v(" "),a("p",[s._v("完成后下载并解压之后，我们可以直接通过下面这个脚本指令快速启动"),a("code",[s._v("arthas")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("./as.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"常见指令介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见指令介绍"}},[s._v("#")]),s._v(" 常见指令介绍")]),s._v(" "),a("p",[s._v("步入"),a("code",[s._v("arthas")]),s._v("我们就可以进行一些比较基础的操作，以下是笔者日常用的比较多的指令，和"),a("code",[s._v("Linux")]),s._v("差不多，读者可自行参阅了解")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("cat")]),s._v("：打印文件内容。")]),s._v(" "),a("li",[a("code",[s._v("cls")]),s._v("：清空当前屏幕区域内容。")]),s._v(" "),a("li",[a("code",[s._v("grep")]),s._v("：匹配查找。")]),s._v(" "),a("li",[a("code",[s._v("history")]),s._v("：打印历史命令。")]),s._v(" "),a("li",[a("code",[s._v("pwd")]),s._v("：输入当前"),a("code",[s._v("Java")]),s._v("进程所在的位置。")]),s._v(" "),a("li",[a("code",[s._v("quit")]),s._v("：退出当前"),a("code",[s._v("arthas")]),s._v("客户端。")]),s._v(" "),a("li",[a("code",[s._v("stop")]),s._v("：关闭"),a("code",[s._v("arthas")]),s._v("服务端，所有"),a("code",[s._v("arthas")]),s._v("客户端都会退出。")])]),s._v(" "),a("p",[s._v("这里笔者就简单的演示一下，可以看到"),a("code",[s._v("pwd")]),s._v("输出的就是笔者所监控的"),a("code",[s._v("Java")]),s._v("进程所处的文件目录：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("arthas@9121"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当前监控的进程在服务器上的目录")]),s._v("\n/home/sharkchili/arthasExample\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("arthas@9121"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("又比如笔者通过"),a("code",[s._v("memory")]),s._v("查看堆内存使用情况，如果只想看老年代的数据，就可以使用grep:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("memory "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" ps_old_gen\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("点击"),a("code",[s._v("quit")]),s._v("会直接退出当前进程的客户端，"),a("code",[s._v("stop")]),s._v("同理只不过多是连着服务端和其他客户端一并杀掉，这里就不多做演示了：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("arthas@9121"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ quit\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接返回到服务器的目录")]),s._v("\nsharkchili@DESKTOP-7IPKPVJ:~/arthas$\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"快捷启动配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#快捷启动配置"}},[s._v("#")]),s._v(" 快捷启动配置")]),s._v(" "),a("p",[s._v("为了快捷启动"),a("code",[s._v("arthas")]),s._v("，笔者也给出个人的配置方式，首先"),a("code",[s._v("vim")]),s._v("一个名为"),a("code",[s._v("as.sh")]),s._v("的脚本，其内容为"),a("code",[s._v("arthas-boot.jar")]),s._v("的启动指令：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-jar")]),s._v(" /home/sharkchili/arthas/arthas-boot.jar\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("完成脚本编写确认启动无误之后，我们将这个脚本通过"),a("code",[s._v("alias")]),s._v("重命名的方式追加到"),a("code",[s._v("/etc/profile")]),s._v("下，内容如下即"),a("code",[s._v("sh")]),s._v("指令加上上述脚本的全路径：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("alias")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("as")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sh /home/sharkchili/arthas/as.sh"')]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949360.png",alt:""}})]),s._v(" "),a("p",[s._v("然后通过"),a("code",[s._v("source")]),s._v("指令使其生效即可。对应mac用户也是同理，指定下载arthas的jar包到指定路径后，编辑相同的启动脚本添加到"),a("code",[s._v("~/.zshrc")]),s._v("并通过"),a("code",[s._v("source")]),s._v("使之生效，以笔者为例则是：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("alias")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("as")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/Users/sharkchili/arthas/as.sh"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("可以看到完成这样一段配直接后，我们可以直接通过"),a("code",[s._v("as")]),s._v("指令完成"),a("code",[s._v("arthas")]),s._v("的快捷启动：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949673.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"arthas中比较常用的运维指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#arthas中比较常用的运维指令"}},[s._v("#")]),s._v(" Arthas中比较常用的运维指令")]),s._v(" "),a("h3",{attrs:{id:"查看实时数据面板"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看实时数据面板"}},[s._v("#")]),s._v(" 查看实时数据面板")]),s._v(" "),a("p",[s._v("日常开发维护过程中对于项目的巡检还是蛮重要的，通过"),a("code",[s._v("Arthas")]),s._v("的"),a("code",[s._v("dashboard")]),s._v("可以非常直观的查看当前系统中进程的运行情况。")]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("arthas")]),s._v("的控制面板输入"),a("code",[s._v("dashboard")]),s._v("，默认情况下"),a("code",[s._v("5s")]),s._v("进行一次刷新：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949803.png",alt:""}})]),s._v(" "),a("p",[s._v("这里我们来简单介绍一下第一板块线程中的字段的含义：")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("ID")]),s._v(":java级别的线程id号，注意与jstack中的"),a("code",[s._v("native id")]),s._v("的区别。")]),s._v(" "),a("li",[a("code",[s._v("NAME")]),s._v(":线程名称。")]),s._v(" "),a("li",[a("code",[s._v("GROUP")]),s._v(":线程所在线程组名。")]),s._v(" "),a("li",[a("code",[s._v("PRIORITY")]),s._v(":线程优先级，值越大优先级越高。")]),s._v(" "),a("li",[a("code",[s._v("STATE")]),s._v(":线程运行状态。")]),s._v(" "),a("li",[a("code",[s._v("CPU%")]),s._v(":线程CPU使用率。")]),s._v(" "),a("li",[a("code",[s._v("DELTA_TIME")]),s._v(":上次采样之后，线程运行的CPU时间，单位为秒。")]),s._v(" "),a("li",[a("code",[s._v("TIME")]),s._v(":线程运行的总CPU时长，数据格式为分:秒。")]),s._v(" "),a("li",[a("code",[s._v("INTERRUPTED")]),s._v(":线程当前的中断位状态。")]),s._v(" "),a("li",[a("code",[s._v("DAEMON")]),s._v(" :是否为守护线程。")])]),s._v(" "),a("p",[s._v("以本次输出位列，可以看到1号线程(一般都是main线程)信息为;")]),s._v(" "),a("ol",[a("li",[s._v("group为main线程组")]),s._v(" "),a("li",[s._v("优先级为5也就是默认优先级")]),s._v(" "),a("li",[s._v("线程处于运行也就是runnable状态")]),s._v(" "),a("li",[s._v("本次采集到的CPU使用率为0")]),s._v(" "),a("li",[s._v("因为是第一次采集且刚开始采集，所以"),a("code",[s._v("DELTA_TIME")]),s._v("运行时间为8s")]),s._v(" "),a("li",[s._v("中断标志为为false")]),s._v(" "),a("li",[s._v("main线程非守护线程")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949911.png",alt:""}})]),s._v(" "),a("p",[s._v("第二板块就是内存使用版块，记录各个堆区、元空间的内存使用情况以及GC情况，以笔者为例，当前项目使用jdk版本为8且使用的回收器对应新生代是"),a("code",[s._v("Parallel Scavenge收集器")]),s._v(" + "),a("code",[s._v("老年代PS MarkSweep （其实跟Serial old共用同一份代码")]),s._v("），所以对应几个比较常用的参数含义分别是：")]),s._v(" "),a("ol",[a("li",[s._v("堆内存81M已使用30M")]),s._v(" "),a("li",[s._v("新生代eden区31M已用14M，而survivor则是5M用了4M")]),s._v(" "),a("li",[s._v("老年代45M已用11M")]),s._v(" "),a("li",[s._v("元空间45M基本用完")]),s._v(" "),a("li",[s._v("新生代触发3次gc耗时19ms")]),s._v(" "),a("li",[s._v("老年代触发1次耗时21ms")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949026.png",alt:""}})]),s._v(" "),a("p",[s._v("而第三板块则是服务器运行参数版块，这一版块记录着程序当前运行服务器的内核版本信息、jdk版本等，以笔者为例则是Linux系统和jdk8版本：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949092.png",alt:""}})]),s._v(" "),a("p",[s._v("需要了解的是"),a("code",[s._v("arthas")]),s._v("中的操作指令可以通过"),a("code",[s._v("--help")]),s._v("了解查阅，我们以"),a("code",[s._v("dashboard")]),s._v("为例，其使用说明如下，可以看到我们可以通过-i决定面板刷新间隔(单位是毫秒)，用-n决定面板刷新次数：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949160.png",alt:""}})]),s._v(" "),a("p",[s._v("所以如果我们希望每1s刷新1次，刷新5次，那么对应的命令就是：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("dashboard "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"查看jvm信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看jvm信息"}},[s._v("#")]),s._v(" 查看JVM信息")]),s._v(" "),a("p",[a("code",[s._v("arthas")]),s._v("也可能非常直观的查看"),a("code",[s._v("jvm")]),s._v("信息，对应的指令也就是"),a("code",[s._v("jvm")]),s._v("。")]),s._v(" "),a("p",[s._v("同样的这个指令也会输出多个板块的内容，我们先来看看第一个板块，可以可以看到该指令可以非常直观的看到机器名称、jvm启动时间、jdk版本以及我们配置jvm参数信息：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949344.png",alt:""}})]),s._v(" "),a("p",[s._v("由于板块比较多，这里笔者就说几个笔者比较常用的板块，分别是线程板块和文件描述符板块，通过这两个板块笔者可以日常巡检了解是否发生线程死锁或者程序中是否出现资源未能及时关闭的情况:")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("THREAD")]),s._v(":它记录当前活跃线程数、活跃的守护线程数、从JVM启动开启曾经活着的最大线程数、总共启动线程数以及发生死锁的线程数。")]),s._v(" "),a("li",[a("code",[s._v("FILE-DESCRIPTOR")]),s._v("：这个板块记录JVM可以打开的最大文件描述符和当前已经打开的文件描述符数。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949406.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"查看和修改日志级别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看和修改日志级别"}},[s._v("#")]),s._v(" 查看和修改日志级别")]),s._v(" "),a("p",[a("code",[s._v("logger")]),s._v("指令也算是笔者比较喜欢的指令，它可以非常直观的查看我们对于日志的配置，如下图，以笔者当前运行的程序为例，可以看到如下几个信息：")]),s._v(" "),a("ol",[a("li",[s._v("日志级别为"),a("code",[s._v("INFO")]),s._v("。")]),s._v(" "),a("li",[s._v("存储错误日志的"),a("code",[s._v("ERROR_FILE")]),s._v("的相对路径。")]),s._v(" "),a("li",[s._v("存储普通日志"),a("code",[s._v("INFO_FILE")]),s._v("的相对路径。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949586.png",alt:""}})]),s._v(" "),a("p",[s._v("当然我们也可以查看指定名字的日志信息，例如我们想查看"),a("code",[s._v("com.example.arthasExample.TestController")]),s._v("的日志信息，就可以直接键入"),a("code",[s._v("logger -n com.example.arthasExample.TestController")]),s._v("指令进行查看：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949609.png",alt:""}})]),s._v(" "),a("p",[a("code",[s._v("logger")]),s._v("指令还有一个比较实用的功能，即直接修改日志级别，例如我们希望修改"),a("code",[s._v("ROOT")]),s._v("这个名称的日志级别，就可以基于如下步骤完成修改：")]),s._v(" "),a("ol",[a("li",[s._v("获取"),a("code",[s._v("classLoader")]),s._v("的哈希码。")]),s._v(" "),a("li",[s._v("基于哈希码通过"),a("code",[s._v("logger")]),s._v("指令修改日志级别。")])]),s._v(" "),a("p",[s._v("我们程序中有这样一段代码，此时我们请求下面这个接口只会输出"),a("code",[s._v("info")]),s._v("级别的日志：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/user/logger"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("loggerPrint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"info logger"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("debug")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"debug logger"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"success"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("对应的输出结果为：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v("-08-19 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":53:29.454  INFO  c.e.a.TestController          :138  http-nio-8080-exec-1                    info logger\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("接下来我们就直接通过"),a("code",[s._v("arthas")]),s._v("修改日志级别，首先我们需要获取当前"),a("code",[s._v("classloader")]),s._v("的哈希码：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("sc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" com.example.arthasExample.TestController\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949729.png",alt:""}})]),s._v(" "),a("p",[s._v("然后我们直接通过这个哈希码，执行如下指令将日志设置为debug")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("logger "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" 306a30c7 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" ROOT "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--level")]),s._v(" debug\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("于是"),a("code",[s._v("debug")]),s._v("日志就出现了：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v("-08-20 00:13:31.438  INFO  c.e.a.TestController          :138  http-nio-8080-exec-6                    info logger\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v("-08-20 00:13:31.439  DEBUG c.e.a.TestController          :139  http-nio-8080-exec-6                    debug logger\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"查看jvm内存信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看jvm内存信息"}},[s._v("#")]),s._v(" 查看JVM内存信息")]),s._v(" "),a("p",[s._v("接下来就是"),a("code",[s._v("memory")]),s._v("指令，这也是笔者比较常用的指令之一，通过"),a("code",[s._v("memory")]),s._v("我们可以监控到当前内存的使用情况。如下图所示，键入"),a("code",[s._v("memory")]),s._v("指令后我们就可以看到这些区域的内存已用、总大小、最大值以及使用率等信息：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949846.png",alt:""}})]),s._v(" "),a("p",[s._v("对应的我们也给出上文中"),a("code",[s._v("memory")]),s._v("各行代表的含义：")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("heap")]),s._v(":堆区内存。")]),s._v(" "),a("li",[a("code",[s._v("ps_eden_space")]),s._v(":堆内存中新生代"),a("code",[s._v("Eden")]),s._v("区。")]),s._v(" "),a("li",[a("code",[s._v("ps_survivor_space")]),s._v(":堆内存中新生代"),a("code",[s._v("survivor")]),s._v("区。")]),s._v(" "),a("li",[a("code",[s._v("ps_old_gen")]),s._v(":堆内存老年代区。")]),s._v(" "),a("li",[a("code",[s._v("nonheap")]),s._v(":非堆内存，即堆内存之外的内存。")]),s._v(" "),a("li",[a("code",[s._v("code_cache")]),s._v(":因为Java执行是将字节码编译为机器码，而这个区域就是用于缓存这部分代码。")]),s._v(" "),a("li",[a("code",[s._v("metaspace")]),s._v(":元空间，以jdk1.8为例该空间是用于存储Java类和方法的元数据信息、常量池等。")]),s._v(" "),a("li",[a("code",[s._v("compressed_class_space")]),s._v(":存放类文件信息的区域。")])]),s._v(" "),a("p",[s._v("对应的我们在这里也简单的复习一下"),a("code",[s._v("JVM")]),s._v("内存区域的分布，建议读者可参考下图了解"),a("code",[s._v("memory")]),s._v("指令中各个字段的含义：\n"),a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949137.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"查看jvm的环境变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看jvm的环境变量"}},[s._v("#")]),s._v(" 查看JVM的环境变量")]),s._v(" "),a("p",[a("code",[s._v("arthas")]),s._v("的"),a("code",[s._v("sysenv")]),s._v("指令常用于获取系统环境变量信息，键入这条指令我们可以看到当前java程序所使用的系统大部分环境变量信息，如下图，可以看到大部分的当前系统用户名称、编码格式、当前程序路径以及客户端ip和端口号等信息：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949329.png",alt:""}})]),s._v(" "),a("p",[s._v("根据"),a("code",[s._v("help")]),s._v("的提示，这条指令同样也支持查询单个环境变量，不过意义不大，毕竟不是每个都知道环境变量叫什么，只有查看了才知道(笑):")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("arthas@23543"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ sysenv "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PWD")]),s._v("\n KEY                                              VALUE                                                                                                                                                                                               \n------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PWD")]),s._v("                                              /home/sharkchili/arthasExample\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"查看和修改jvm系统属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看和修改jvm系统属性"}},[s._v("#")]),s._v(" 查看和修改JVM系统属性")]),s._v(" "),a("p",[a("code",[s._v("sysprop")]),s._v("查看的jvm的系统属性，基本上通过这个指令我们可以看到大部分的"),a("code",[s._v("JVM")]),s._v("参数配置信息，如下输出结果，我们大体可以看到JDK版本、程序名称以及日志编码格式和当前系统用户名称等：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949503.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"查看当前jvm线程堆栈信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看当前jvm线程堆栈信息"}},[s._v("#")]),s._v(" 查看当前JVM线程堆栈信息")]),s._v(" "),a("p",[a("code",[s._v("arthas")]),s._v("提供"),a("code",[s._v("thread")]),s._v("指令用于查看线程情况，如下所示，它基本打印了线程计数信息和几个活跃的线程的实时情况，默认情况下，它是按照"),a("code",[s._v("CPU")]),s._v("增量时间降序进行排序：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949682.png",alt:""}})]),s._v(" "),a("p",[s._v("按照"),a("code",[s._v("help")]),s._v("的提示，我们也可以通过-n打印前几个忙碌的线程调用堆栈信息，如下所示，笔者希望打印出前2条忙碌的线程，键入的指令为"),a("code",[s._v("thread -n 2")]),s._v(":")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949902.png",alt:""}})]),s._v(" "),a("p",[s._v("同时"),a("code",[s._v("arthas")]),s._v("也支持按照时间间隔进行输出打印，比如我们希望列出5s内最忙的3个线程，那么对应的指令就是：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("thread "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("当我们的Java程序有大量的线程时候，我们希望筛选中某种状态的线程，我们可以通过"),a("code",[s._v("--state")]),s._v("指定，例如我们希望打印处于"),a("code",[s._v("RUNNABLE")]),s._v("状态的线程，那么我们就可以键入"),a("code",[s._v("thread --state RUNNABLE")]),s._v("来获得输出结果：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949043.png",alt:""}})]),s._v(" "),a("p",[s._v("对于死锁问题，我们也可以通过-b指令来定位查看当前程序是否存在阻塞其他线程的线程，如下图所示，以笔者为例当前程序就不存在死锁的情况：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949137.png",alt:""}})]),s._v(" "),a("p",[s._v("此时我们给出一个触发死锁的接口并调用：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dead-lock"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("deadLock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//线程1先取得锁1，休眠后取锁2")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t1 successfully acquired the lock1......"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t1 successfully acquired the lock1......"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//线程2先取得锁2，休眠后取锁1")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t2 successfully acquired the lock2......"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t2 successfully acquired the lock1......"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br")])]),a("p",[s._v("此时，键入-b指令就可以定位阻塞其他线程的线程以及所在代码段：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949325.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"vmtool对于jvm的调控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vmtool对于jvm的调控"}},[s._v("#")]),s._v(" vmtool对于JVM的调控")]),s._v(" "),a("p",[s._v("vmtool算是笔者用的比较多的一个工具指令，可用于查询对象或者强制GC等功能，这些功能读者可自行参考官网查阅：")]),s._v(" "),a("p",[s._v("vmtool:"),a("a",{attrs:{href:"https://arthas.aliyun.com/doc/vmtool.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://arthas.aliyun.com/doc/vmtool.html"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("而笔者这里想要介绍的是一个强制打断线程的功能，这个指令对于特定场景下应急处理还是蛮实用的。")]),s._v(" "),a("p",[s._v("我们的程序调用下面的接口被系统监控到CPU100%，此时我们就可以通过arthas进行特定场景下的应急处理：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cpu-100"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cpu")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//无限循环输出打印")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cpu working"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"thread-1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("我们通过thread指令看到thread-1基本将单个CPU跑满了，并且我们通过控制台定位到对应的id为48：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949536.png",alt:""}})]),s._v(" "),a("p",[s._v("此时我们可以通过"),a("code",[s._v("vmtool")]),s._v("的"),a("code",[s._v("action")]),s._v("指令将线程打断：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("vmtool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--action")]),s._v(" interruptThread "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("完成操作之后即可看到这个线程被我们成功打断了：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949682.png",alt:""}})]),s._v(" "),a("p",[s._v("同时"),a("code",[s._v("vmTool")]),s._v("也支持观测变量的详情，以下面这个实例变量"),a("code",[s._v("dateTimeStr")]),s._v(" 为例，每次接口请求都会实时刷新：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" dateTimeStr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DateUtil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("formatDateTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/getVal"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getVal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        dateTimeStr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DateUtil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("formatDateTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dateTimeStr: {}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dateTimeStr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"success"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("如果我们希望查看此刻dateTimeStr 的值，我们就可以通过"),a("code",[s._v("vmtool")]),s._v("的"),a("code",[s._v("action")]),s._v("指定为"),a("code",[s._v("getInstances")]),s._v(" ，然后指定类的全路径"),a("code",[s._v("(以笔者这段代码为例则是com.example.arthasExample.TestController)")]),s._v("，最后键入表达式"),a("code",[s._v("instances[0].dateTimeStr")]),s._v("意为获取当前实例的"),a("code",[s._v("dateTimeStr")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("vmtool  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--action")]),s._v(" getInstances "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--className")]),s._v(" com.example.arthasExample.TestController  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--express")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'instances[0].dateTimeStr'")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("此时我们就可以非常直观的监控到这个变量的信息了：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949787.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"常见的运维操作示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见的运维操作示例"}},[s._v("#")]),s._v(" 常见的运维操作示例")]),s._v(" "),a("h3",{attrs:{id:"反编译查看代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反编译查看代码"}},[s._v("#")]),s._v(" 反编译查看代码")]),s._v(" "),a("p",[s._v("上文我们其实已经用到了jad这个反编译命令，对于笔者来说，"),a("code",[s._v("jad")]),s._v("有两种比较常见的用法，除了上述那种反编译类的指令"),a("code",[s._v("jad --source-only 类的包路径")]),s._v("，还有一种定位方法代码段的命令"),a("code",[s._v("jad --source-only 类的包路径 方法名")]),s._v("。")]),s._v(" "),a("p",[s._v("例如笔者想定位"),a("code",[s._v("TestController")]),s._v("的"),a("code",[s._v("deadLock")]),s._v("代码，我们就可以键入:")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("jad "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("source"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("only  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("example"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("arthasExample"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("TestController")]),s._v(" deadLock\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如下图，我们可以直接看到的方法的代码:")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949885.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"查看字段详情"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看字段详情"}},[s._v("#")]),s._v(" 查看字段详情")]),s._v(" "),a("p",[s._v("我们希望看到某个类下所有字段的详情，我们就可以使用这条命令")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("sc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" 类的包路径\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("例如笔者想查看"),a("code",[s._v("TestController")]),s._v("的字段详情，就可以键入这条命令：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("sc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" com.example.arthasExample.TestController\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("可以看到这条指令不仅可以查看字段的定义和注解，还可以查看线程池的使用情况以及集合内部的"),a("code",[s._v("value")]),s._v("：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949968.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"查看方法列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看方法列表"}},[s._v("#")]),s._v(" 查看方法列表")]),s._v(" "),a("p",[s._v("这条命令笔者不是很常用，为了教程的完整性笔者也演示一下，假如我们希望查看某个类的方法，可以使用:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("sm 类的包路径\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("以笔者为例,查看"),a("code",[s._v("TestController")]),s._v("的方法为:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" sm com.example.arthasExample.TestController\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("输出结果如下:")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949053.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"静态变量监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#静态变量监控"}},[s._v("#")]),s._v(" 静态变量监控")]),s._v(" "),a("p",[a("code",[s._v("Arthas")]),s._v("提供了对静态变量的分析，以下面这段代码为例，如果笔者希望看到"),a("code",[s._v("list")]),s._v(" 内部详情，我们就可以使用"),a("code",[s._v("ognl")]),s._v("表达式获取：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" list "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"add"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"val"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("在我们执行完接口完成添加操作之后，我们可以直接使用ognl进行监控。例如我们希望查看上述list的内容，我们就可以使用命令:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" ognl "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@类的包路径@变量名'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("所以如果笔者查看list的命令为:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" ognl "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@com.example.arthasExample.TestController@list'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("注意，某些场景下使用ongl表达式查看字段信息需要指明"),a("code",[s._v("classLoader")]),s._v("的"),a("code",[s._v("hashCode")]),s._v("，否则会报错，所以我们需要通过sc指令先获取当前类的hashCode：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("sc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" com.example.arthasExample.TestController\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如下图"),a("code",[s._v("TestController")]),s._v("的类加载器的哈希码为"),a("code",[s._v("68de145")]),s._v(":")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949142.png",alt:""}})]),s._v(" "),a("p",[s._v("于是对应的指令我们可以改为"),a("code",[s._v("ognl -c 68de145 '@com.example.arthasExample.TestController@list'")]),s._v("，而输出结果如下，可以看到变量的类型和数值都可以看到：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949233.png",alt:""}})]),s._v(" "),a("p",[s._v("当然"),a("code",[s._v("ognl")]),s._v("还有一些比较特殊的用法，例如查看集合的长度，添加元素到集合中等操作，具体可以参考"),a("code",[s._v("GitHub")]),s._v("这个"),a("code",[s._v("issue")]),s._v(":")]),s._v(" "),a("p",[s._v("https://github.com/alibaba/arthas/issues/71:"),a("a",{attrs:{href:"https://github.com/alibaba/arthas/issues/71",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/alibaba/arthas/issues/71"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"基于arthas进行问题诊断"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基于arthas进行问题诊断"}},[s._v("#")]),s._v(" 基于Arthas进行问题诊断")]),s._v(" "),a("h3",{attrs:{id:"定位cpu-100-问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定位cpu-100-问题"}},[s._v("#")]),s._v(" 定位CPU 100%问题")]),s._v(" "),a("p",[a("code",[s._v("CPU 100%")]),s._v("问题算是生产环境下最难排查的问题了，在没有"),a("code",[s._v("Arthas")]),s._v("之前，我们常规的排查思路大致为:")]),s._v(" "),a("ol",[a("li",[s._v("使用"),a("code",[s._v("top")]),s._v("确定是否为"),a("code",[s._v("java")]),s._v("进程。")]),s._v(" "),a("li",[s._v("明确是当前"),a("code",[s._v("java")]),s._v("进程之后，通过"),a("code",[s._v("jps")]),s._v("定位"),a("code",[s._v("java")]),s._v("进程号。")]),s._v(" "),a("li",[s._v("找到最吃资源的线程号。")]),s._v(" "),a("li",[s._v("将线程号转为十六进制。")]),s._v(" "),a("li",[s._v("通过"),a("code",[s._v("jstack")]),s._v("导出日志并使用全局搜索十六进制线程号定位到问题代码段。")])]),s._v(" "),a("p",[s._v("有了"),a("code",[s._v("Arthas")]),s._v("之后，问题的定位就会简单快速许多，为了演示这个例子，笔者编写了一段模拟"),a("code",[s._v("CPU 100%")]),s._v("问题的代码段:")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" threadPool "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("newCachedThreadPool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cpu-100"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cpu")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//无限循环输出打印")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cpu working"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"thread-1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("我们不断请求该地址，不久后你就会发现CPU直接飙升接近100%，此时我们的arthas就派上用场了，首先我们自然是将"),a("code",[s._v("arthas")]),s._v("启动。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-jar")]),s._v(" arthas-boot.jar\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("此时控制台会出现下面几个选项，它通过不同序号标明不同的Java程序，我们看到我们的目标程序"),a("code",[s._v("ArthasExampleApplication")]),s._v("，序号为1，所以我们输入1按回车。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("F:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("github"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("java "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-jar")]),s._v(" arthas-boot.jar\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" JAVA_HOME: D:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("myinstall"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("jdk8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("jre8\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" arthas-boot version: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.6")]),s._v(".9\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Found existing "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v(" process, please choose one and input the serial number of the process, eg "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". Then hit ENTER.\n* "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18720")]),s._v(" com.example.arthasExample.ArthasExampleApplication\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19300")]),s._v(" org.jetbrains.jps.cmdline.Launcher\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7876")]),s._v(" org.jetbrains.idea.maven.server.RemoteMavenServer\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14488")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("进入控制台，我们直接键入thread命令可以看到，有一个名为 "),a("code",[s._v("pool-1-thread-1")]),s._v("的线程CPU使用率非常高，所以我们需要定位它所工作的代码段。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949396.png",alt:""}})]),s._v(" "),a("p",[s._v("由控制台可知，它的序号为59，所以我们直接键入:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" thread "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("59")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("很快的，我们直接定位到了问题代码段，在"),a("code",[s._v("TestController")]),s._v("的42行。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949497.png",alt:""}})]),s._v(" "),a("p",[s._v("知道了代码的位置之后，我们根据类的包路径"),a("code",[s._v("com.example.arthasExample.TestController")]),s._v("直接通过"),a("code",[s._v("Arthas")]),s._v("反编译查看源码，命令如下:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("jad --source-only  com.example.arthasExample.TestController\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("最终我们定位到了问题代码，即时修复即可：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949558.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"定位线程死锁问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定位线程死锁问题"}},[s._v("#")]),s._v(" 定位线程死锁问题")]),s._v(" "),a("p",[s._v("对于线程死锁问题，我们也给出下面这样一段示例代码，线程1先取锁1再取锁2，线程2反之，两者取锁顺序构成环路造成死锁。")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//两把锁")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" lock1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" lock2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dead-lock"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("deadLock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//线程1先取得锁1，休眠后取锁2")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t1 successfully acquired the lock1......"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t1 successfully acquired the lock1......"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//线程2先取得锁2，休眠后取锁1")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t2 successfully acquired the lock2......"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t2 successfully acquired the lock1......"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br")])]),a("p",[s._v("了解代码流程之后，我们直接调用这个接口，打开"),a("code",[s._v("Arthas")]),s._v("查看键入"),a("code",[s._v("thread")]),s._v("线程信息可以看到我们的t1和t2两个线程处于等待状态，大概率存在问题。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949641.png",alt:""}})]),s._v(" "),a("p",[s._v("随后我们直接键入"),a("code",[s._v("thread -b")]),s._v("，发现t2线程被锁住了，由此断定这两个线程看定存在死锁，")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949741.png",alt:""}})]),s._v(" "),a("p",[s._v("由上述结果我们可知两个线程的id分别是65和66，所以使用"),a("code",[s._v("thread id号")]),s._v("的命令直接定位到问题代码段并解决问题即可。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949851.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"运行耗时性能问题排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行耗时性能问题排查"}},[s._v("#")]),s._v(" 运行耗时性能问题排查")]),s._v(" "),a("p",[s._v("对于统计耗时的操作我们经常会用打日志的方式来监控，在环境复杂的生产环境，我们常因为欠缺考虑而忘记对某些方法进行监控。\n同样的"),a("code",[s._v("Arthas")]),s._v("也为我们提供了一些便捷的命令来完成对方法耗时的监控与统计。")]),s._v(" "),a("p",[s._v("这里笔者这里给出一段"),a("code",[s._v("UserServiceImpl")]),s._v(" 模拟用户查询时进行参数校验、其他"),a("code",[s._v("service")]),s._v("调用、"),a("code",[s._v("redis")]),s._v("调用、"),a("code",[s._v("MySQL")]),s._v("调用。")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Slf4j")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserServiceImpl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("queryUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" uid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("check")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("redis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mysql")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" uid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"调用其他service。。。。。"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RandomUtil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("randomLong")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("redis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" uid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"查看redis缓存数据。。。。。"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MILLISECONDS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RandomUtil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("randomInt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mysql")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" uid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"查询MySQL数据......"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RandomUtil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("randomInt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),s._v(" jsonObject "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        jsonObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("putOnce")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xiaoming"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        jsonObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("putOnce")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" jsonObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("check")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" uid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" uid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"非法用户id，uid:{}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" uid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"非法用户id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br")])]),a("p",[s._v("对应的"),a("code",[s._v("controller")]),s._v("代码如下，假如我们在生产环境下发现这个接口非常耗时，我们又没有日志，那么我们如何利用"),a("code",[s._v("Arthas")]),s._v("排查耗时问题呢？")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserServiceImpl")]),s._v(" userService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/user"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("queryUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" uid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" userService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("queryUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("我们可以用"),a("code",[s._v("trace")]),s._v("命令，我们首先用"),a("code",[s._v("trace")]),s._v("追踪一下"),a("code",[s._v("TestController")]),s._v(" 的"),a("code",[s._v("queryUser")]),s._v("耗时的调用:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("trace com.example.arthasExample.TestController queryUser\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("可以发现"),a("code",[s._v("TestController")]),s._v(" 并无异常，所有的耗时都在"),a("code",[s._v("UserServiceImpl")]),s._v(" :")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949027.png",alt:""}})]),s._v(" "),a("p",[s._v("所以我们再对"),a("code",[s._v("UserServiceImpl")]),s._v(" 的"),a("code",[s._v("queryUser")]),s._v("进行追踪：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" trace com.example.arthasExample.UserServiceImpl queryUser\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("完成命令键入后，控制台就会阻塞监控这个方法，然后我们调用一下这个接口，可以发现原来是"),a("code",[s._v("MySQL")]),s._v("查询非常耗时，由此我们就可以进一步去推断问题了。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949039.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"方法耗时统计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方法耗时统计"}},[s._v("#")]),s._v(" 方法耗时统计")]),s._v(" "),a("p",[s._v("有时候我们希望监控某个方法单位时间内请求的耗时和调用情况，我们就可以使用monitor命令，例如我们希望每5s查看TestController 的queryUser的情况，我们就可以键入:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" monitor  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" com.example.arthasExample.TestController queryUser\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("可以看到控制台会每5s输入请求次数、成功和失败次数以及平均耗时等信息。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949071.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"定位出入参错误问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定位出入参错误问题"}},[s._v("#")]),s._v(" 定位出入参错误问题")]),s._v(" "),a("p",[s._v("有时候我们希望定位某个日志没有打到的方法的出入参详情，例如上面的mysql()的出入参，我们完全可以通过"),a("code",[s._v("Arthas")]),s._v("的"),a("code",[s._v("watch")]),s._v("方法做到，对应命令为:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" com.example.arthasExample.UserServiceImpl mysql "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{params[0],returnObj}'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("可以看到，我们的入参为1，出参是一个对象。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949154.png",alt:""}})]),s._v(" "),a("p",[s._v("更进一步，假如我们希望可以打印出对象的内容，那么我们就可以使用"),a("code",[s._v("toString")]),s._v("方法做到")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" com.example.arthasExample.UserServiceImpl mysql "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{params[0],returnObj.toString()}'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949209.png",alt:""}})]),s._v(" "),a("p",[s._v("除此之外watch 还支持很多的骚操作，具体可以参考官方文档:")]),s._v(" "),a("p",[s._v("https://arthas.aliyun.com/doc/watch.html:"),a("a",{attrs:{href:"https://arthas.aliyun.com/doc/watch.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://arthas.aliyun.com/doc/watch.html"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"监控方法调用路径"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#监控方法调用路径"}},[s._v("#")]),s._v(" 监控方法调用路径")]),s._v(" "),a("p",[s._v("还是以上文mysql方法为例，如果我们希望快速定位到它的调用路径，我们可以使用stack方法:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("stack com.example.arthasExample.UserServiceImpl mysql\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("可以看到详细的调用路径直接输出到控制台。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949313.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"获取方法调用的过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取方法调用的过程"}},[s._v("#")]),s._v(" 获取方法调用的过程")]),s._v(" "),a("p",[s._v("我们希望查看方法调用时出现异常的原因，出参和入参时，可以使用tt这条指令,例如我们想查看check方法为何会报错，我们就可以使用tt")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("tt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" com.example.arthasExample.UserServiceImpl check\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("从输出结果来看，第二次抛出异常了，我们可以基于"),a("code",[s._v("1001")]),s._v("这个索引去定位问题。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949373.png",alt:""}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" tt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("最终可以得出，入参为-1：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949453.png",alt:""}})]),s._v(" "),a("p",[s._v("如果我们想重新发起调用，可以直接使用：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("tt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("需要强调的是，tt 命令是将当前环境的对象引用保存起来，但仅仅也只能保存一个引用而已。如果方法内部对入参进行了变更，或者返回的对象经过了后续的处理，那么在 tt 查看的时候将无法看到当时最准确的值。这也是为什么 watch 命令存在的意义。")])]),s._v(" "),a("p",[s._v("所以使用完tt指令后，我们建议清除所有的 tt 记录：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("tt --delete-all\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"内存溢出问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#内存溢出问题"}},[s._v("#")]),s._v(" 内存溢出问题")]),s._v(" "),a("p",[s._v("以下面这段代码为例，通过不断发起请求调用，复现"),a("code",[s._v("OOM")]),s._v("问题：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadPoolExecutor")]),s._v(" poolExecutor "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadPoolExecutor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MINUTES")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LinkedBlockingQueue")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 创建线程池，通过线程池，保证创建的线程存活")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/oom"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("oom")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletRequest")]),s._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        poolExecutor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            localVariable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 为线程添加变量")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"success"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("然后通过"),a("code",[s._v("arthas")]),s._v("发现老年代内存几乎已满，gc也十分频繁。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949613.png",alt:""}})]),s._v(" "),a("p",[s._v("由此我们可以直接使用"),a("code",[s._v("Arthas")]),s._v("的"),a("code",[s._v("heapdump")]),s._v(" 导出文件到mat中进行进一步分析。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" heapdump D://heap.hprof\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("导出的结果如下，后续我们就可以点击detail推断到问题的源头了。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949707.png",alt:""}})]),s._v(" "),a("p",[s._v("最终我们很快速的定位到了问题代码:")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949779.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"arthas的一些进阶操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#arthas的一些进阶操作"}},[s._v("#")]),s._v(" Arthas的一些进阶操作")]),s._v(" "),a("h3",{attrs:{id:"线上替换代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#线上替换代码"}},[s._v("#")]),s._v(" 线上替换代码")]),s._v(" "),a("p",[s._v("有时候我们测试难免会遗漏一些情况，如下所示，我们业务要求id小于1才抛出异常，但是我们因为粗心而将判断条件写成id<2，结果懵懵懂懂的就将这段代码部到了生产环境，导致业务查询出了问题。")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/user/{id}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findUserById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@PathVariable")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id: {}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IllegalArgumentException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id < 1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("putOnce")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("putOnce")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("对于生产环境，我们肯定是无法立刻重启替换jar包的，对于这类问题，我们完全可以使用"),a("code",[s._v("arthas")]),s._v("实现在线热更新。")]),s._v(" "),a("p",[s._v("首先第一步，我们将生产环境的字节码反编译并导出到本地，如下所示")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("jad  --source-only com.example.arthasExample.TestController "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  d://TestController.java\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后我们修改一下对应的代码段")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949875.png",alt:""}})]),s._v(" "),a("p",[s._v("然后我们需要找到这个类对应类加载器的hash码")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("sc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" *TestController "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" classLoaderHash\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949960.png",alt:""}})]),s._v(" "),a("p",[s._v("找到对应"),a("code",[s._v("hash")]),s._v("码之后，我们就可以基于这个类加载器将修改后的Java文件编译成字节码文件:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" 18b4aac2 d://TestController.java "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" d://\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("最后我们将代码热更新到正在运行的程序：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("redefine d://com/example/arthasExample/TestController.class\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("此时我们传1作为参数就不会报错了，说明代码热更新成功了。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949028.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"获取spring上下文进行进一步分析操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取spring上下文进行进一步分析操作"}},[s._v("#")]),s._v(" 获取spring上下文进行进一步分析操作")]),s._v(" "),a("p",[s._v("有时候我们希望在线上获取"),a("code",[s._v("Spring")]),s._v("容器分析定位问题，我们完全可以通过"),a("code",[s._v("arthas")]),s._v("拦截到这个类并进行进一步调用和分析。")]),s._v(" "),a("p",[s._v("读过"),a("code",[s._v("Spring MVC")]),s._v("源码的读者可能都知道，每当又"),a("code",[s._v("HTTP")]),s._v("请求发送到web容器时都会进行请求进行映射转发处理时都会经过"),a("code",[s._v("RequestMappingHandlerAdapter")]),s._v("这个适配器上，查看"),a("code",[s._v("RequestMappingHandlerAdapter")]),s._v("的类图，可以看到它继承了"),a("code",[s._v("WebApplicationObjectSupport")]),s._v("，而该类有一个方法"),a("code",[s._v("getApplicationContext")]),s._v("它就可以直接获得Spring上下文，所以接下来笔者就演示如何通过tt指令获得"),a("code",[s._v("RequestMappingHandlerAdapter")]),s._v("从而调用"),a("code",[s._v("getApplicationContext")]),s._v("拿到上下文，开始各种骚操作。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949182.png",alt:""}})]),s._v(" "),a("p",[s._v("首先我们使用tt指令对"),a("code",[s._v("RequestMappingHandlerAdapter")]),s._v(" 进行追逐，如下所示，笔者通过-t知名要追踪的类的全路径和方法，后续只要有请求调用该方法，tt指令就会显示追踪的信息：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("tt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter invokeHandlerMethod\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("然后我们随便调用一个接口，得到调用记录：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949201.png",alt:""}})]),s._v(" "),a("p",[s._v("我们就以索引为"),a("code",[s._v("1000")]),s._v("的调用记录，通过"),a("code",[s._v("-w")]),s._v("指定ognl获取到"),a("code",[s._v("spring")]),s._v("上下文并获取到"),a("code",[s._v("testController")]),s._v("然后完成一个方法调用：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("tt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'target.getApplicationContext().getBean(\"testController\").findUserById(3)'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如下图，可以看到，我们成功的完成了调用并得到了返回结果。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949269.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"常见问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见问题"}},[s._v("#")]),s._v(" 常见问题")]),s._v(" "),a("h3",{attrs:{id:"arthas统计方法耗时watch指令的原理是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#arthas统计方法耗时watch指令的原理是什么"}},[s._v("#")]),s._v(" arthas统计方法耗时watch指令的原理是什么")]),s._v(" "),a("p",[a("code",[s._v("watch")]),s._v("指令示例如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" com.example.MyService sayHello "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"{params, result, throwExp} -> { return 'Exception: ' + throwExp; }\"")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-E")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("我们从指令即可看出他可以获取到类的全路径，对此我们不拿理解，它就是基于这个类的全路径定位到类的全路径，并对该类型通过字节码桩技术对类的方法进行增强，即插入一段代码进行在方法执行前后插入时间，实现耗时统计：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512010949545.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),a("p",[s._v("自此我们对Arthas的常见操作都已演示完成，更多关于Arthas的使用读者可以参考Arthas官网，希望对你有帮助：")]),s._v(" "),a("p",[s._v("https://arthas.aliyun.com/doc/:"),a("a",{attrs:{href:"https://arthas.aliyun.com/doc/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://arthas.aliyun.com/doc/"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("我是 "),a("strong",[s._v("SharkChili")]),s._v(" ，Java 开发者，"),a("strong",[s._v("Java Guide")]),s._v(" 开源项目维护者。欢迎关注我的公众号："),a("strong",[s._v("写代码的SharkChili")]),s._v("，也欢迎您了解我的开源项目 mini-redis："),a("a",{attrs:{href:"https://github.com/shark-ctrl/mini-redis",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/shark-ctrl/mini-redis"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),a("p",[s._v("Arthas官网:"),a("a",{attrs:{href:"https://arthas.aliyun.com/doc/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://arthas.aliyun.com/doc/"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("Arthas基础(一):"),a("a",{attrs:{href:"https://blog.csdn.net/wfw123123/article/details/120010941",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.csdn.net/wfw123123/article/details/120010941"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("Arthas - Java 线上问题定位处理的终极利器｜ 8月更文挑战: "),a("a",{attrs:{href:"https://juejin.cn/post/6993130443654725668#heading-24",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://juejin.cn/post/6993130443654725668#heading-24"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("Arthas排查jvm相关问题的利器: "),a("a",{attrs:{href:"https://www.qinglite.cn/doc/439664780602670ae",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.qinglite.cn/doc/439664780602670ae"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("新的开始 | Arthas GitHub Star 破万后的回顾和展望:"),a("a",{attrs:{href:"https://juejin.cn/post/6844903783244234765#heading-3",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://juejin.cn/post/6844903783244234765#heading-3"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("阿里巴巴Arthas实践--jad/mc/redefine线上热更新一条龙:"),a("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzkxNDI0ODE0NQ==&mid=2247483937&idx=1&sn=177cd8e97428a053c6365d24aee94c4b&source=41#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://mp.weixin.qq.com/s?__biz=MzkxNDI0ODE0NQ==&mid=2247483937&idx=1&sn=177cd8e97428a053c6365d24aee94c4b&source=41#wechat_redirect"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("Alibaba Arthas实践--获取到Spring Context，然后为所欲为："),a("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzkxNDI0ODE0NQ==&mid=2247483935&idx=1&sn=af7eabb4b6c39f362acb6eebeb7ed8b0&source=41#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://mp.weixin.qq.com/s?__biz=MzkxNDI0ODE0NQ==&mid=2247483935&idx=1&sn=af7eabb4b6c39f362acb6eebeb7ed8b0&source=41#wechat_redirect"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("深入探究 JVM | 探秘 Metaspace:"),a("a",{attrs:{href:"https://www.sczyh30.com/posts/Java/jvm-metaspace/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.sczyh30.com/posts/Java/jvm-metaspace/"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("JVM运行时内存\n:"),a("a",{attrs:{href:"https://blog.csdn.net/m0_53611007/article/details/120685628",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.csdn.net/m0_53611007/article/details/120685628"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("Java诊断神器Arthas:"),a("a",{attrs:{href:"https://blog.csdn.net/sundehui01/article/details/121921481",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.csdn.net/sundehui01/article/details/121921481"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("PS MarkSweep 和Serial Old 的区别:"),a("a",{attrs:{href:"https://www.jianshu.com/p/624338a8d51b",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.jianshu.com/p/624338a8d51b"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);