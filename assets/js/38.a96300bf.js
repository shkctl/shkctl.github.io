(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{395:function(s,t,a){"use strict";a.r(t);var n=a(8),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"写在文章开头"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#写在文章开头"}},[s._v("#")]),s._v(" 写在文章开头")]),s._v(" "),t("p",[s._v("之前几篇文章笔者介绍"),t("code",[s._v("arthas")]),s._v("基础运维使用和线上问题技巧的使用，很多读者可能会感觉"),t("code",[s._v("arthas")]),s._v("指令记忆成本很高，好在市面上提供了一个不错的插件"),t("code",[s._v("arthas idea")]),s._v("，通过该插件我们即可快速基于现有项目代码段，生成线上排查指令。而本文也将从几个比较经典且常见的场景演示一下如何基于arthas idea快死生成排查指令快速完成java应用程序诊断。")]),s._v(" "),t("p",[s._v("因为这篇文章是完全基于arthas idea生成指令解决特定问题，所以，无论你是否先前是否具备arthas使用经验，都可以通过本文的学习，掌握arthas这款的工具的日常使用。")]),s._v(" "),t("p",[s._v("我是 "),t("strong",[s._v("SharkChili")]),s._v(" ，Java 开发者，"),t("strong",[s._v("Java Guide")]),s._v(" 开源项目维护者。欢迎关注我的公众号："),t("strong",[s._v("写代码的SharkChili")]),s._v("，也欢迎您了解我的开源项目 mini-redis："),t("a",{attrs:{href:"https://github.com/shark-ctrl/mini-redis",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/shark-ctrl/mini-redis"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("p",[s._v("为方便与读者交流，现已创建读者群。关注下方公众号获取我的联系方式，添加时备注"),t("strong",[s._v("加群")]),s._v("即可加入。")]),s._v(" "),t("h2",{attrs:{id:"准备工作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[s._v("#")]),s._v(" 准备工作")]),s._v(" "),t("p",[s._v("，在正式演示"),t("code",[s._v("arthas idea")]),s._v("前，读者务必到"),t("code",[s._v("idea")]),s._v("插件市场搜索并安装一下arthas命令生成插件"),t("code",[s._v("arthas-idea")]),s._v("：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037518.png",alt:""}})]),s._v(" "),t("p",[s._v("同时，arthas idea也内置的下载arthas的快捷生成指令选项，我们只需右键选择install as.sh即可生成下载和启动指令：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037664.png",alt:""}})]),s._v(" "),t("p",[s._v("我们将生成的指令粘贴到终端，对应指令如下图，可以看到该指令会通过curl完成下载，然后修改权限并将其启动，此时我们就可以通过进程的名称键入序号进入程序的管理：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037882.png",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"详解arthas-idea常见运维监控"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#详解arthas-idea常见运维监控"}},[s._v("#")]),s._v(" 详解arthas idea常见运维监控")]),s._v(" "),t("h3",{attrs:{id:"查看类加载信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看类加载信息"}},[s._v("#")]),s._v(" 查看类加载信息")]),s._v(" "),t("p",[s._v("没有插件之前我们查看某个类加载信息都需要手动编写"),t("code",[s._v("sc")]),s._v("命令，例如我们想查看"),t("code",[s._v("TestController")]),s._v("这个类元信息，有了arthas idea之后我们只需右键找到"),t("code",[s._v("sc")]),s._v("指令并点击：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037059.png",alt:""}})]),s._v(" "),t("p",[s._v("最终就会生成如下指令，我们可以直接将该指令贴到")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("sc "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" com.example.arthasExample.controller.TestController\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("此时"),t("code",[s._v("arthas")]),s._v("就会加载这个类的信息，通过输出结果就可以直观看到这个类各种元信息、继承关系、以及加载这个类的"),t("code",[s._v("classLoader")]),s._v("的"),t("code",[s._v("hash")]),s._v("码(重点，后续各种操作需要依赖这个类加载器唯一标识)：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037163.png",alt:""}})]),s._v(" "),t("p",[s._v("需要补充的是，"),t("code",[s._v("arthas idea")]),s._v("给出的sc指令是相对基础的指令，如果我们想查看这个类的字段信息，可以补充一个参数"),t("code",[s._v("-f(field)")]),s._v("，以笔者为例，"),t("code",[s._v("TestController")]),s._v("存在如下字段：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" testVal "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" threadPool "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newCachedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" lock1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" lock2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserServiceImpl")]),s._v(" userService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("此时我们就可以基于arthas idea生成的指令基础上，添加一个-f指令：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("c "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v("  com.example.arthasExample.controller.TestController\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("对应的输出结果如下，结合笔者的代码段可以字段是一一对应可印证的：")]),s._v(" "),t("ol",[t("li",[s._v("testVal为静态字段且值为2")]),s._v(" "),t("li",[s._v("线程池当前线程数为0，并没有被使用")]),s._v(" "),t("li",[s._v("lock1和lock2两个锁变量是object类型")]),s._v(" "),t("li",[s._v("list为静态类型且没有添加任何元素：")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037272.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"查看静态变量实时动态变化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看静态变量实时动态变化"}},[s._v("#")]),s._v(" 查看静态变量实时动态变化")]),s._v(" "),t("p",[t("code",[s._v("arhtas")]),s._v("支持通过上一个示例中笔者提到一个静态的"),t("code",[s._v("list")]),s._v("，它会通过一个接口请求动态添加元素，对应代码如下所示：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"add"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"val"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("而"),t("code",[s._v("arhtas")]),s._v("是支持通过getstatic指令查看静态变量的实时变化，对应指令格式为"),t("code",[s._v("getstatic class_name field_name")]),s._v("选中字段之后，有了arthas idea之后，我们只需定位到list这个变量，通过右键点击"),t("code",[s._v("get static field simple")]),s._v("即可快速生成表达式：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037500.png",alt:""}})]),s._v(" "),t("p",[s._v("于是我们就快速得出静态变量查询的指令：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("getstatic com.example.arthasExample.controller.TestController list "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("对应输出结果如下，可以看到，在笔者通过接口请求动态元素后，通过arthas idea的指令是可以正确的观测到list的变化：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037674.png",alt:""}})]),s._v(" "),t("p",[s._v("简单介绍这个指令后，笔者也就官方的说明做个科普，按照官网的说法，实际上对于静态变量的监控更推荐使用"),t("code",[s._v("ongl")]),s._v("表达式，因为该表达式比较复杂，所以在之前的文章中没有过多的展开，而本文是面向arhtas idea展开的，所以针对这个操作就可以更加详细直观的进行演示：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037699.png",alt:""}})]),s._v(" "),t("p",[s._v("我们还是以"),t("code",[s._v("list")]),s._v("变量演示一下"),t("code",[s._v("ongl")]),s._v("表达式的使用，需要说明的是ongl表达式的参数是需要：")]),s._v(" "),t("ol",[t("li",[s._v("执行表达式")]),s._v(" "),t("li",[s._v("类加载器hashcode")]),s._v(" "),t("li",[s._v("可选参数")])]),s._v(" "),t("p",[s._v("按照笔者的使用经验，日常的spring boot指令用到的类加载器并非默认，所以我们的实践都是需要手动指定classloader的hash，所以笔者日常使用ongl表达式时的步骤都是：")]),s._v(" "),t("ol",[t("li",[s._v("通过sc定位类加载器hash")]),s._v(" "),t("li",[s._v("基于类加载器唯一hash通过arthas idea生成ongl表达式")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037820.png",alt:""}})]),s._v(" "),t("p",[s._v("所以本次的示例我们需要先通过arthas的sc获取到当前类的"),t("code",[s._v("classLoader")]),s._v("的哈希码，对应的操作还是针对这个类点击右键选择search classes loaded by jvm sc：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037012.png",alt:""}})]),s._v(" "),t("p",[s._v("对应的指令和输出结果如下，可以看到"),t("code",[s._v("classLoaderHash")]),s._v("的结果为"),t("code",[s._v("306a30c7")]),s._v("，我们将其记录下文，后续会用到：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037149.png",alt:""}})]),s._v(" "),t("p",[s._v("然后选中需要监控的字段list右键点击生成ongl表达式：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037352.png",alt:""}})]),s._v(" "),t("p",[s._v("最后将之前得到的哈希码粘贴并点击copy command，后去list详情的ongl表达式就生成了：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037484.png",alt:""}})]),s._v(" "),t("p",[s._v("最终表达式和结果如下，是不是很方便呢？")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037549.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"vmtool字段监控成员变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vmtool字段监控成员变量"}},[s._v("#")]),s._v(" vmtool字段监控成员变量")]),s._v(" "),t("p",[s._v("arthas自持通过vmtool查询内存对象的信息，以下面这段代码为例，"),t("code",[s._v("dateTimeStr")]),s._v("这个字符串是跟随者接口请求而实时变化的，如果我们希望查看其及时数据就可以通过"),t("code",[s._v("vmtool")]),s._v("指令查阅：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" dateTimeStr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DateUtil")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("formatDateTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Date")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/getVal"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getVal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        dateTimeStr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DateUtil")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("formatDateTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Date")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"success"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("对应指令生成步骤也是通过在对应字段即dateTimeStr右键选择vmtool get instance invoke method field：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037717.png",alt:""}})]),s._v(" "),t("p",[s._v("然后传入上文留存的sc指令拿到的类加载器hash值，点击copy生成指令：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037867.png",alt:""}})]),s._v(" "),t("p",[s._v("此时，我们就可以直观的看到成员变量的实时变化了：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037958.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"方法执行情况监控"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法执行情况监控"}},[s._v("#")]),s._v(" 方法执行情况监控")]),s._v(" "),t("p",[t("code",[s._v("arhtas")]),s._v("支持"),t("code",[s._v("monitor")]),s._v("指令进行方法监控，如下这段接口代码"),t("code",[s._v("findUserById")]),s._v("的示例，该接口设计id非法校验和查询(直接mock数据)，我们希望查询单位时间内这个方法的执行成功、失败、以及平均耗时等情况，也就是"),t("code",[s._v("monitor")]),s._v("监控指令，也可以直接通过插件快速生成：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("  "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/findUserById/{id}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("findUserById")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@PathVariable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id: {}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IllegalArgumentException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id < 1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//模拟查询返回数据")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("putOnce")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("putOnce")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("对应指令生成方式是在方法名称处右键点击monitor：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037130.png",alt:""}})]),s._v(" "),t("p",[s._v("对应生成指令如下，可以看到，默认情况下，生成的指令为会执行10次，每10s进行一次输出：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("monitor com.example.arthasExample.controller.TestController findUserById  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cycle")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("由此我们就可以实时且直观的监控到方法执行的成功、失败、平均耗时等参数信息：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037291.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"运行耗时"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行耗时"}},[s._v("#")]),s._v(" 运行耗时")]),s._v(" "),t("p",[s._v("之前的文章，我们介绍了trace命令，这个是定位接口耗时情况的有效武器，我们还是以下面这段代码为例,该接口要求传入用户id然后返回用户信息：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/user"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("queryUser")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" uid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" userService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("queryUser")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("考虑到完整性我们给出queryUser的逻辑，其步骤比较简单：")]),s._v(" "),t("ol",[t("li",[s._v("进行"),t("code",[s._v("id")]),s._v("校验，查看id是否是有效值。")]),s._v(" "),t("li",[s._v("调用其他service。")]),s._v(" "),t("li",[s._v("到"),t("code",[s._v("redis")]),s._v("缓存中查看是否有该用户信息。")]),s._v(" "),t("li",[s._v("若步骤3没有结果，则调用MySQL查询。")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("queryUser")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" uid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//入参校验")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("check")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//调用其他service")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("invokeOtherservice")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//redis查询")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),s._v(" jsonObject "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("redis")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jsonObject "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" jsonObject"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//返回MySQL查询结果")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mysql")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("如果我们想定位这个接口的耗时情况，可以直接在service的query方法处右键点击插件找到trace选项生成对应trace指令：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037523.png",alt:""}})]),s._v(" "),t("p",[s._v("此时我们就会得到下面这样一条指令，他给出了我们要追踪的类的全路径以及方法名，默认情况下n为5，即执行5次，然后skipJDKMethod为false即不跳过jdk方法的执行追踪：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("trace com.example.arthasExample.service.UserServiceImpl queryUser  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--skipJDKMethod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("此时我们就可以很直观的看到的最耗时的方法，可以看到最好是的位置是mysql即数据库持久化操作，由此我们就可以根据这个信息去针对性调优：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037650.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"监控方法出入参"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监控方法出入参"}},[s._v("#")]),s._v(" 监控方法出入参")]),s._v(" "),t("p",[s._v("我们以上述接口的MySQL方法为例，我们希望通过watch查看出入参详情，对应方法内容如下：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mysql")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" uid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"查询MySQL数据......"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RandomUtil")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("randomInt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),s._v(" jsonObject "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        jsonObject"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("putOnce")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xiaoming"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        jsonObject"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("putOnce")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" jsonObject"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("生成指令的步骤还是一样的，对准方法然后右键通过插件快捷生成指令：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037795.png",alt:""}})]),s._v(" "),t("p",[s._v("默认情况下指令的会打印出入参和异常，然后执行次数为5，输出的结果属性的遍历深度为3，对应的指令和执行结果如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037891.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"定位方法调用路径"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#定位方法调用路径"}},[s._v("#")]),s._v(" 定位方法调用路径")]),s._v(" "),t("p",[s._v("我们日常用stack追踪方法调用堆栈，我们还是以mysql方法为例，通过插件快速生成：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037039.png",alt:""}})]),s._v(" "),t("p",[s._v("生成的指令默认情况下会给出我们选中的类的全路径和方法名，默认执行5次：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("stack com.example.arthasExample.service.UserServiceImpl mysql  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这样我们就可以快速的得到当前调用的堆栈信息，也就mysql方法调用的来时路：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037200.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"获取方法具体出入参"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取方法具体出入参"}},[s._v("#")]),s._v(" 获取方法具体出入参")]),s._v(" "),t("blockquote",[t("p",[s._v("watch 虽然很方便和灵活，但需要提前想清楚观察表达式的拼写，这对排查问题而言要求太高，因为很多时候我们并不清楚问题出自于何方，只能靠蛛丝马迹进行猜测。\n这个时候如果能记录下当时方法调用的所有入参和返回值、抛出的异常会对整个问题的思考与判断非常有帮助。\n于是乎，TimeTunnel 命令就诞生了。")])]),s._v(" "),t("p",[s._v("下面我们就用"),t("code",[s._v("check")]),s._v("方法为例，来演示一下uid小于0时出入参和错误信息我们如何定位的：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("check")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" uid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" uid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"非法用户id，uid:{}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" uid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"非法用户id"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("首先通过插件点击tt指令")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037364.png",alt:""}})]),s._v(" "),t("p",[s._v("然后点击第一行复制这个指令，可以看到这个指令会指明我们要监控的类和方法，默认情况下执行5次：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037476.png",alt:""}})]),s._v(" "),t("p",[s._v("查看监控结果可以看到，第3次执行报错：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037607.png",alt:""}})]),s._v(" "),t("p",[s._v("查看索引为1003，所以我们键入"),t("code",[s._v("tt -i 1003")]),s._v(",此时我们就可以直观的看到入参和错误详情执行堆栈：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037730.png",alt:""}})]),s._v(" "),t("p",[s._v("注意:tt 相关功能在使用完之后，需要手动释放内存，否则长时间可能导致"),t("code",[s._v("OOM")]),s._v("。退出 "),t("code",[s._v("arthas")]),s._v(" 不会自动清除 tt 的缓存 "),t("code",[s._v("map")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("tt --delete-all\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"详解arthas-idea快速快速定位线上故障"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#详解arthas-idea快速快速定位线上故障"}},[s._v("#")]),s._v(" 详解arthas idea快速快速定位线上故障")]),s._v(" "),t("h3",{attrs:{id:"线程cpu使用率与线程定位"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#线程cpu使用率与线程定位"}},[s._v("#")]),s._v(" 线程CPU使用率与线程定位")]),s._v(" "),t("p",[s._v("第一个场景就是功能编写不当导致线程CPU使用率飙升，笔者使用如下接口模拟这种情况并发起http请求：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cpu-100"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cpu")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//无限循环输出打印")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cpu working"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"thread-1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("随着请求结束后，系统逐渐卡顿，CPU使用率飙升，明确定位到当前"),t("code",[s._v("Java")]),s._v("进程后，我们就可以通过"),t("code",[s._v("arthas")]),s._v("的"),t("code",[s._v("thread")]),s._v("指令定位问题线程执行堆栈。以笔者为例，为了更加简单快速的看到问题线程，笔者直接通过"),t("code",[s._v("thread -n 3")]),s._v("打印出最忙碌的前3个线程。\n此时，我们就可以看到"),t("code",[s._v("TestController")]),s._v("第36行的代码段CPU使用率非常高：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037916.png",alt:""}})]),s._v(" "),t("p",[s._v("此时我们就可以通过反编译的方式进行36行实际的代码，在没有"),t("code",[s._v("arhtas idea")]),s._v("插件之前，我们jad指令都需要手动进行输入，有了idea插件之后，只需找到对应的java文件右键找到"),t("code",[s._v("arthas command")]),s._v("点击"),t("code",[s._v("jad")]),s._v("反编译即可生成指令")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037103.png",alt:""}})]),s._v(" "),t("p",[s._v("以笔者为例，本次通过快捷插件生成的指令为：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("jad --source-only com.example.arthasExample.controller.TestController \n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("我们将生成的指令贴到"),t("code",[s._v("arthas")]),s._v("并执行，由此我们就可以精准定位到线上执行的java程序的问题代码段：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037213.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"快速定位程序内存飙升"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#快速定位程序内存飙升"}},[s._v("#")]),s._v(" 快速定位程序内存飙升")]),s._v(" "),t("p",[t("code",[s._v("arthas")]),s._v("可以说是定位这类疑难杂症的神奇，笔者将应用程序堆内存设置为"),t("code",[s._v("128m")]),s._v("启动：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xms128m")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xmx128m")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-jar")]),s._v(" arthasExample.jar\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("然后不断调用这个接口让每个线程threadlocal map填充4m的数组，让应用程序内存飙升：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/oom"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("oom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletRequest")]),s._v(" request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        poolExecutor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Byte")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Byte")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            localVariable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 为线程添加变量")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"success"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("随着时间推移，系统内存使用率飙升，明确定位到当前程序之后，先用"),t("code",[s._v("memory")]),s._v("指令观察一下程序当前的内存使用情况，可以看到堆内存使用率远超过业界设定的阈值即70%：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037335.png",alt:""}})]),s._v(" "),t("p",[s._v("然后我们不断的请求该接口，随着时间推移，从dashboard中也直观看到这个，老年代在疯狂的gc平均一次gc耗时大约32ms，且单位时间内gc次数非常频繁：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037441.png",alt:""}})]),s._v(" "),t("p",[s._v("此时我们就可以借助插件快速生成"),t("code",[s._v("heapdump")]),s._v("指令，导出该应用的内存快照：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037656.png",alt:""}})]),s._v(" "),t("p",[s._v("从指令上看，默认情况下，内存快照会被dump到tmp目录下：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("heapdump /tmp/dump.hprof\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("然后我们就可以通过"),t("code",[s._v("MAT")]),s._v("定位到出现问题的线程，点击"),t("code",[s._v("with in incoming refrences")]),s._v("查看这些对象被作为哪个对象的内部引用：")]),s._v(" "),t("p",[s._v("这里也补充说明一下Incomming Reference和Outgoing Reference 的区别：")]),s._v(" "),t("blockquote",[t("p",[s._v("Incomming Reference 指的是引用当前对象的对象，Outgoing Reference 指的是当前对象引用的对象。对象的incomming reference 保证对象处于 alive 从而免于被垃圾回收掉 ；Outgoing reference 则展示了对象内部的具体内容，有助于我们分析对象的属性 。")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037860.png",alt:""}})]),s._v(" "),t("p",[s._v("可以看到所有的byte数组都指向一个pool-3-thread开头的线程池，此时我们就可以基于本地开发代码定位对应的线程池了：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037105.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"线上替换故障代码段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#线上替换故障代码段"}},[s._v("#")]),s._v(" 线上替换故障代码段")]),s._v(" "),t("p",[s._v("日常紧急需求上线难免会有些问题，这时候就需要保证服务不停机的情况下完成热点代码替换，可能大部分团队都会通过"),t("code",[s._v("hotfix")]),s._v("分支补丁结合灰度发布的方式完成紧急上线，实际上"),t("code",[s._v("arthas")]),s._v("是直接反编译修改代码完成热点替换的。")]),s._v(" "),t("p",[s._v("在正式介绍热点代码替换前，笔者还是需要有几个特殊说明：")]),s._v(" "),t("ol",[t("li",[s._v("热点代码替换只支持已经加载的类，对于没有完成加载的类无法通过arthas完成替换")]),s._v(" "),t("li",[s._v("完成替换后如果使用watch、trace等指令这个替换就会失效")]),s._v(" "),t("li",[s._v("非必要不要在生产环境使用，存在风险")])]),s._v(" "),t("p",[s._v("这里笔者就以下面这个接口为例，演示一下如何通过通过arthas 将id校验逻辑修改为小于0校验：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/findUserById/{id}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("findUserById")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@PathVariable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id: {}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IllegalArgumentException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id < 1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("putOnce")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("putOnce")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[t("code",[s._v("arthas")]),s._v("热更新代码的步骤比较固定，大体分为三步：")]),s._v(" "),t("ol",[t("li",[s._v("jad反编译")]),s._v(" "),t("li",[s._v("mc编译生成字节码")]),s._v(" "),t("li",[s._v("redefine完成热点代码更新")])]),s._v(" "),t("p",[s._v("有了arthas idea之后，这一切都无需我们操心，因为arthas idea内置了一个快捷指令，我们只需指明项目名称，并将修改的代码加以编译，即可通过快捷插件生成对应替换指令即可完成热点替换。")]),s._v(" "),t("p",[s._v("以上接口对应项目为例，笔者通过jps得知项目名称为"),t("code",[s._v("com.example.arthasExample.ArthasExampleApplication")]),s._v("，于是就在如下配置处选择手动配置项目名称：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037247.png",alt:""}})]),s._v(" "),t("p",[s._v("完成功能代码修改后，点击编译生成最新字节码：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037468.png",alt:""}})]),s._v(" "),t("p",[s._v("针对该代码右键点击选择refine，此时arthas idea就会针对这段代码生成一段指令完成：")]),s._v(" "),t("ol",[t("li",[s._v("下载arhtas")]),s._v(" "),t("li",[s._v("select进入我们配置的项目")]),s._v(" "),t("li",[s._v("将修改后的代码通过refine完成热更新")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037655.png",alt:""}})]),s._v(" "),t("p",[s._v("我们直接通过终端运行指令，可以看到arthas本质就是将修改后的字节码转为base64作为参数传入一个HotSwap脚本并执行完成热点代码更新：\n"),t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037031.png",alt:""}})]),s._v(" "),t("p",[s._v("这里笔者也给出生成的arthas-idea-plugin-hot-swap.sh的核心代码段，可以看到其本质就是select进程后，将我们修改后的base64字节码替换到运行进程的字节码完成动态加载更新：\n"),t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037157.png",alt:""}})]),s._v(" "),t("p",[s._v("此时我们执行curl就可以看到id为1的查询是正常的：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("➜  github "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://localhost:8848/findUserById/1\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user1"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),s._v(":18"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("%\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("同时，基于边界值进行验证，可以发现日志打印输出的是小于0才抛出校验异常：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037279.png",alt:""}})]),s._v(" "),t("p",[s._v("这里笔者仅仅演示了热更新中的最简单的剪切板替换，因为"),t("a",{attrs:{href:"https://www.yuque.com/arthas-idea-plugin/help/pwxhb4#1vlwC",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.yuque.com/arthas-idea-plugin/help/pwxhb4#1vlwC"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"arthas-idea进阶操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#arthas-idea进阶操作"}},[s._v("#")]),s._v(" arthas idea进阶操作")]),s._v(" "),t("h3",{attrs:{id:"基于arthas-idea快速操纵spring容器上下文"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基于arthas-idea快速操纵spring容器上下文"}},[s._v("#")]),s._v(" 基于arthas idea快速操纵spring容器上下文")]),s._v(" "),t("p",[s._v("我们都知道spring中有个上下文叫"),t("code",[s._v("applicationContext")]),s._v("，它记录着所有的bean的信息，通过该容器我们可以得到所有的bean进行各种操作。")]),s._v(" "),t("p",[s._v("这意味着如果我们在spring项目中如果有什么特殊的执行操作，完全可以通过tt定位到包含上下文的类，然后获取其applicationContext完成特殊操作。")]),s._v(" "),t("p",[s._v("举个例子,我们的"),t("code",[s._v("TestController")]),s._v("有一个方法"),t("code",[s._v("findUserById")]),s._v("，我们希望通过tt指令定位到这个"),t("code",[s._v("bean")]),s._v("对应的上下文"),t("code",[s._v("applicationContext")]),s._v("并完成对这个方法的调用：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/user/{id}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("findUserById")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@PathVariable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id: {}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IllegalArgumentException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id < 1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("putOnce")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("putOnce")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("读过Spring MVC源码的读者可能都知道，每当有"),t("code",[s._v("HTTP")]),s._v("请求发送到web容器时请求进行映射转发处理时都会经过"),t("code",[s._v("RequestMappingHandlerAdapter")]),s._v("，从下面的类图不难看出它继承了"),t("code",[s._v("WebApplicationObjectSupport")]),s._v("，而该类有一个方法"),t("code",[s._v("getWebApplicationContext")]),s._v("可以让我们获取到"),t("code",[s._v("spring")]),s._v("容器的上下文，进而去分析管理spring容器：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041037450.png",alt:""}})]),s._v(" "),t("p",[s._v("所以我们通过插件生成"),t("code",[s._v("RequestMappingHandlerAdapter")]),s._v("的tt指令：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041045196.png",alt:""}})]),s._v(" "),t("p",[s._v("然后等待用户请求后，定位到这个类的执行记录，如下图对应1001索引就是笔者的请求：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041038161.png",alt:""}})]),s._v(" "),t("p",[s._v("基于这个索引对应的target，其实就是我们的"),t("code",[s._v("RequestMappingHandlerAdapter")]),s._v("，我们通过-w 像写java代码一样获取到"),t("code",[s._v("applicationContext")]),s._v("从而得到"),t("code",[s._v("testController")]),s._v("最终完成调用：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("tt "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'target.getApplicationContext().getBean(\"testController\").findUserById(3)'")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("最终我们如愿完成了调用：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512041038301.png",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"小结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),t("p",[s._v("本文笔者直接通过IDEA插件快速生成Arthas指令快速完成日常JVM运维和故障定位工作，可以看到有了插件的配合我们只需大概记住指令的作用即可，每当我们需要使用的时候，只需要结合插件生成一下指令进行相应简单调整即可快速得到想要的指令。")]),s._v(" "),t("p",[s._v("自此本文讲解结束，希望对你有帮助。")]),s._v(" "),t("p",[s._v("我是 "),t("strong",[s._v("SharkChili")]),s._v(" ，Java 开发者，"),t("strong",[s._v("Java Guide")]),s._v(" 开源项目维护者。欢迎关注我的公众号："),t("strong",[s._v("写代码的SharkChili")]),s._v("，也欢迎您了解我的开源项目 mini-redis："),t("a",{attrs:{href:"https://github.com/shark-ctrl/mini-redis",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/shark-ctrl/mini-redis"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("p",[s._v("为方便与读者交流，现已创建读者群。关注下方公众号获取我的联系方式，添加时备注"),t("strong",[s._v("加群")]),s._v("即可加入。")]),s._v(" "),t("h2",{attrs:{id:"参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),t("p",[s._v("arthas 执行ognl表达式ClassNotFoundException:"),t("a",{attrs:{href:"https://blog.csdn.net/w605283073/article/details/106535170",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.csdn.net/w605283073/article/details/106535170"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("arthas idea使用手册:"),t("a",{attrs:{href:"https://www.yuque.com/arthas-idea-plugin",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.yuque.com/arthas-idea-plugin"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("jvm参数配置:"),t("a",{attrs:{href:"https://blog.csdn.net/wang379275614/article/details/78471604",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.csdn.net/wang379275614/article/details/78471604"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("Java诊断神器Arthas："),t("a",{attrs:{href:"https://blog.csdn.net/sundehui01/article/details/121921481",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.csdn.net/sundehui01/article/details/121921481"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("Java内存分析工具MAT(Memory Analyzer Tool)的介绍与使用:"),t("a",{attrs:{href:"https://juejin.cn/post/7030664794843660302#heading-6",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://juejin.cn/post/7030664794843660302#heading-6"),t("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=e.exports}}]);