(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{396:function(t,s,a){"use strict";a.r(s);var n=a(8),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"写在文章开头"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#写在文章开头"}},[t._v("#")]),t._v(" 写在文章开头")]),t._v(" "),s("p",[t._v("应用系统监控也是软件研发中最重要的一环，从研发的角度来说，明确指出自己业务维度明确指出个人负责功能业务维度的系统监控指标，同时具备实时监控诊断的应对方法，是软件架构成功的重要的一环。所以本文将针对故障和监控两个重要概念展开探讨，同时给出一种理想化的架构结合实践案例基于参考，希望对你有所帮助。")]),t._v(" "),s("p",[t._v("我是 "),s("strong",[t._v("SharkChili")]),t._v(" ，Java 开发者，"),s("strong",[t._v("Java Guide")]),t._v(" 开源项目维护者。欢迎关注我的公众号："),s("strong",[t._v("写代码的SharkChili")]),t._v("，也欢迎您了解我的开源项目 mini-redis："),s("a",{attrs:{href:"https://github.com/shark-ctrl/mini-redis",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/shark-ctrl/mini-redis"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("p",[t._v("为方便与读者交流，现已创建读者群。关注下方公众号获取我的联系方式，添加时备注"),s("strong",[t._v("加群")]),t._v("即可加入。")]),t._v(" "),s("h2",{attrs:{id:"浅谈监控的基本概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#浅谈监控的基本概念"}},[t._v("#")]),t._v(" 浅谈监控的基本概念")]),t._v(" "),s("h3",{attrs:{id:"故障的生命周期"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#故障的生命周期"}},[t._v("#")]),t._v(" 故障的生命周期")]),t._v(" "),s("p",[t._v("故障的生命周期分为以下几个阶段：")]),t._v(" "),s("ol",[s("li",[t._v("故障开始")]),t._v(" "),s("li",[t._v("故障发现")]),t._v(" "),s("li",[t._v("故障定位")]),t._v(" "),s("li",[t._v("及时修复")]),t._v(" "),s("li",[t._v("系统恢复")])]),t._v(" "),s("p",[t._v("这其中，故障发现和通知在市面上已经有一套相对成熟的体系参考，无论是运维还是研发总会有一套自己系统监控的理论，并在应用中完成运用实现监控和告警。\n那么问题来了，从研发的角度，针对系统监控各项性能指标，如何明确定位到具体的错误？例如：")]),t._v(" "),s("ol",[s("li",[t._v("系统提示CPU飙升，面对宏观的性能指标，我们如何知晓故障线程？")]),t._v(" "),s("li",[t._v("web请求全体夯死，系统监控全面告知线程处于"),s("code",[t._v("wating")]),t._v("状态，我们如何定位到问题的根因并优化？")]),t._v(" "),s("li",[t._v("程序堆内存飙升达到与之，我们如何定位到进程级别的具体问题对象从而定位到问题的栈帧？")])]),t._v(" "),s("p",[t._v("如下图，这就是笔者面板中最常见的容器线程直线飙升导致大量请求夯死超时，按照现有体系中的"),s("code",[t._v("grafana")]),t._v("监控面板，面对成百上千的接口请求，即时我们能够准确的做到故障发现，也无法非常快速精准的做到故障定位：\n"),s("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512080901176.png",alt:""}})]),t._v(" "),s("p",[t._v("缺少精准的定位动作，就看导致止损动作对故障恢复没有任何帮助，就需要进行重新定位，进而导致负责人员花费大量时间在故障发现和止损动作之间循环往复的执行。")]),t._v(" "),s("h3",{attrs:{id:"笔者理想中的监控体系"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#笔者理想中的监控体系"}},[t._v("#")]),t._v(" 笔者理想中的监控体系")]),t._v(" "),s("p",[t._v("监控是可以确保提前暴露被即时发现解决，同时也可以作为日常循环后系统调优的佐证。所以量化一切监控体系之后，我们就需要搭建一个完善、安全、成熟的监控诊断体系来排查定位问题， 以笔者研发的java应用为例，主流的应用监控会通过"),s("code",[t._v("micrometer")]),t._v("采集目标监控指标，并将其同步到"),s("code",[t._v("prometheus")]),t._v("并通过"),s("code",[t._v("grafana")]),t._v("进行增强渲染，在此基础之上通过"),s("code",[t._v("Nightingale")]),t._v("针对这些告急的监控及时下发企微消息或者短信告警让研发人员介入解决问题：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512080901334.png",alt:""}})]),t._v(" "),s("p",[t._v("按照笔者上面的说法，这种做法存在如下几个问题：")]),t._v(" "),s("ol",[s("li",[t._v("市面仅仅指定常见系统级别监控指标，粒度在如今的应用系统中显得过于宽泛")]),t._v(" "),s("li",[t._v("团队指定指标往往会因为各种原因无法精准、明确，可快速定位检索各种异常和监控故障的应用级别监控指标")]),t._v(" "),s("li",[s("code",[t._v("grafana")]),t._v("和"),s("code",[t._v("Nightingale")]),t._v("是面向于运维和研发的通用，且着重于监控可视化和阈值告警，并不能很好的做到监控诊断。")])]),t._v(" "),s("p",[t._v("所以，在此基础之上笔者也给出了一套基于自己常见的工具所衍生了一套带有监控诊断的监控运维体系架构，即在上述监控体系下集成强阿里系中强大的监控诊断工具"),s("code",[t._v("arthas")]),t._v("。")]),t._v(" "),s("p",[t._v("如下图，在这套监控体系下，通过"),s("code",[t._v("arthas tunel")]),t._v("远程统一管理所有被"),s("code",[t._v("arthas agent")]),t._v("代理的"),s("code",[t._v("java")]),t._v("应用程序，当其他监控运维工具感知异常时，我们就可以快速通过浏览器"),s("code",[t._v("attach")]),t._v("到存在故障的进程中，以超细粒度灵活的指令和表达式定位"),s("code",[t._v("java")]),t._v("程序中对象内存占用、"),s("code",[t._v("CPU")]),t._v("利用率甚至是栈帧的调用细节：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512080901638.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"基于arhtas的应用远程监控实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基于arhtas的应用远程监控实践"}},[t._v("#")]),t._v(" 基于arhtas的应用远程监控实践")]),t._v(" "),s("h3",{attrs:{id:"arthas监控诊断体系说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#arthas监控诊断体系说明"}},[t._v("#")]),t._v(" arthas监控诊断体系说明")]),t._v(" "),s("p",[t._v("基于上述的说明，我们大体了解的监控诊断的一套理想架构，而本文将针对该架构进行演示和实践，按照"),s("code",[t._v("arthas")]),t._v("官网的说明，对于"),s("code",[t._v("spring boot")]),t._v("项目，我们在项目中引入"),s("code",[t._v("arthas-spring-boot-starter")]),t._v("，其底层会启动一个"),s("code",[t._v("arthas")]),t._v("进程并"),s("code",[t._v("attach")]),t._v("到装配的应用上，由此构建出当前服务的"),s("code",[t._v("arthas agent")]),t._v("：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512080901769.png",alt:""}})]),t._v(" "),s("p",[t._v("这一点，我们可以通过"),s("code",[t._v("ArthasConfiguration")]),t._v("的"),s("code",[t._v("arthasAgent")]),t._v("这个"),s("code",[t._v("bean")]),t._v("得以印证，可以看到它会拉取"),s("code",[t._v("spring boot")]),t._v("配置后，通过这个配置构建"),s("code",[t._v("arthasAgent")]),t._v("并调用init完成如下工作：")]),t._v(" "),s("ol",[s("li",[t._v("通过"),s("code",[t._v("Instrumentation")]),t._v("注册字节码转换器即"),s("code",[t._v("ClassFileTransformer")]),t._v("，后续通过该技术实现类加载或者运行时字节码动态增强")]),t._v(" "),s("li",[t._v("拉取一个"),s("code",[t._v("artahs agent")]),t._v("并"),s("code",[t._v("attach")]),t._v("到当前进程构成"),s("code",[t._v("artahs")]),t._v("服务端，监听客户端指令完成目标类增强：")])]),t._v(" "),s("p",[t._v("对应笔者也给出这段源码的视线入口，读者可以自行参阅：")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@ConditionalOnMissingBean")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArthasAgent")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("arthasAgent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" arthasConfigMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArthasProperties")]),t._v(" arthasProperties"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Throwable")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tarthasConfigMap "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringUtils")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeDashKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arthasConfigMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 给配置全加上前缀")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" mapWithPrefix "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HashMap")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arthasConfigMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("size")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Entry")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" entry "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" arthasConfigMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("entrySet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\tmapWithPrefix"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"arthas."')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" entry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" entry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//基于配置完成构建artahs agent，完成arthas agent服务端初始化，监听客户端指令完成字节码增强")]),t._v("\n\t\t\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArthasAgent")]),t._v(" arthasAgent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArthasAgent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mapWithPrefix"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" arthasProperties"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHome")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\tarthasProperties"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isSlientInit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t\tarthasAgent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tlogger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Arthas agent start success."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" arthasAgent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br")])]),s("p",[t._v("同时，考虑到当前应用体系下成百个服务，我们需要有一个统一的入口集中化监控管理，所以为了能够有一个统一的入口集中管理所有的agent，我们会专门用一台与外界隔离的服务器部署一个"),s("code",[t._v("Arthas Tunnel")]),t._v("，让所有的应用程序生成agent后统一与tunel建立连接，后续我们就可以通过"),s("code",[t._v("tunel")]),t._v("暴露的端口，统一管理监控诊断存在异常风险的应用程序：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512080901923.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"项目中集成arthas"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#项目中集成arthas"}},[t._v("#")]),t._v(" 项目中集成arthas")]),t._v(" "),s("p",[t._v("对于需要"),s("code",[t._v("arthas agent")]),t._v("的程序，我们首先需要引入"),s("code",[t._v("arthas")]),t._v(" 脚手架依赖包：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("dependency"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("groupId"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("com.taobao.arthas"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("/groupId"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("artifactId"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("arthas-spring-boot-starter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("/artifactId"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("version"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.4")]),t._v("."),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v("<")]),t._v("/version"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("/dependency"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[t._v("然后配置agent唯一id并指定tunel的注册地址(默认暴露端口为7777)：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("arthas.agent-id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("hsehdfsfghhwertyfad\narthas.tunnel-server"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ws://127.0.0.1:7777/ws\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("随后我们到官网下载并启动tunel")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-jar")]),t._v(" arthas-tunnel-server-4.1.2-fatjar.jar\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("此时我们就可以启动我们的java程序了，控制台出现如下提示，则说明服务启动并成功注册到arthas了：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2025")]),t._v("-12-07 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":09:21.370  INFO "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("68696")]),t._v(" --- "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("           main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" c.a.arthas.spring.ArthasConfiguration    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" Arthas agent start success.\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2025")]),t._v("-12-07 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":09:21.483  INFO "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("68696")]),t._v(" --- "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("           main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" o.s.b.w.embedded.tomcat.TomcatWebServer  "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" Tomcat initialized with port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18080")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("此时键入http://127.0.0.1:8080/即可进入tunel面板，键入刚刚的agentid即可直接进入监控面板：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512080901083.png",alt:""}})]),t._v(" "),s("p",[t._v("这里补充说明一下感兴趣的读者可以到官网拉取"),s("code",[t._v("arhtas")]),t._v("的源码包，以笔者为例这里选择"),s("code",[t._v("arhtas-all-3.6.0")]),t._v("版本，并在配置文件中关闭"),s("code",[t._v("redis")]),t._v("监控，避免本机没有redis服务端连接导致自动装配阶段报错：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("management.health.redis.enabled")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("false\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("通过运行"),s("code",[t._v("ArthasTunnelApplication")]),t._v("将"),s("code",[t._v("tunel")]),t._v("启动：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512080901362.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"arthas-tunel系统架构监控实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#arthas-tunel系统架构监控实践"}},[t._v("#")]),t._v(" arthas tunel系统架构监控实践")]),t._v(" "),s("p",[t._v("回到最早的问题，面对大量飙升处于"),s("code",[t._v("wating")]),t._v("状态的线程因为监控工具和指标的局限性而发做到快速的监控诊断，有了"),s("code",[t._v("arthas")]),t._v("监控诊断体系架构，笔者用下面这样的一个接口模拟一个存在问题的分页查询并演示一下快速的解决步骤：")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v(" "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/slow-request"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JSONObject")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("handleUserPageQuery")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 调用service的用户分页列表查询方法")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" userService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUserPageList")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])]),s("p",[t._v("查看"),s("code",[t._v("UserService")]),t._v("的"),s("code",[t._v("getUserPageList")]),t._v("，可以看到其内部用休眠模拟分页查询的长耗时：")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JSONObject")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUserPageList")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"开始查询用户分页列表"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 模拟耗时的用户分页列表查询，休眠1分钟")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThreadUtil")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeUnit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DAYS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 构造分页列表结果")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JSONObject")]),t._v(" result "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JSONObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        result"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"code"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        result"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"message"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"success"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JSONObject")]),t._v(" data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JSONObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"total"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pageSize"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"currentPage"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 模拟用户列表数据")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JSONObject")]),t._v(" user1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JSONObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        user1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        user1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"张三"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        user1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"email"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"zhangsan@example.com"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JSONObject")]),t._v(" user2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JSONObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        user2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        user2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"李四"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        user2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"email"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lisi@example.com"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"users"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JSONObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("user1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" user2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        result"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"data"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"用户分页列表查询完成"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" result"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br")])]),s("p",[t._v("通过上文的"),s("code",[t._v("tunel")]),t._v("入口，我们很快的进入到程序内部，简单快速的定位的"),s("code",[t._v("tomcat")]),t._v("那些存在"),s("code",[t._v("time")]),t._v(" "),s("code",[t._v("wating")]),t._v("的问题线程：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512080901546.png",alt:""}})]),t._v(" "),s("p",[t._v("非常简单干脆的定位到了问题线程的栈帧，很好的完成监控体系中的监控诊断这一步：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qiniuyun.sharkchili.com/202512080901792.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"小结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[t._v("#")]),t._v(" 小结")]),t._v(" "),s("p",[t._v("笔者认为，一个健壮的系统运维监控体系是着重于强调量化且可感知观测的，在日常工作的对接中，我发现大量研发人员都有一种计算机文科化的趋势，小到应用程序指标调测，达到故障定位暴力迭代结合日志盲目推测。\n结合这些问题，笔者通过这篇文章给出一个理想的监控体系，也希望对读者有所启发。")]),t._v(" "),s("p",[t._v("我是 "),s("strong",[t._v("SharkChili")]),t._v(" ，Java 开发者，"),s("strong",[t._v("Java Guide")]),t._v(" 开源项目维护者。欢迎关注我的公众号："),s("strong",[t._v("写代码的SharkChili")]),t._v("，也欢迎您了解我的开源项目 mini-redis："),s("a",{attrs:{href:"https://github.com/shark-ctrl/mini-redis",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/shark-ctrl/mini-redis"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("p",[t._v("为方便与读者交流，现已创建读者群。关注下方公众号获取我的联系方式，添加时备注"),s("strong",[t._v("加群")]),t._v("即可加入。")]),t._v(" "),s("p",[t._v("我是 SharkChili ，Java 开发者，Java Guide 开源项目维护者。欢迎关注我的公众号：写代码的SharkChili，也欢迎您了解我的开源项目 mini-redis：https://github.com/shark-ctrl/mini-redis。")]),t._v(" "),s("p",[t._v("为方便与读者交流，现已创建读者群。关注上方公众号获取我的联系方式，添加时备注加群即可加入。")]),t._v(" "),s("h2",{attrs:{id:"参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),s("p",[t._v("阿里Arthas深度详解：从底层原理到生产实战，Java问题排查不再愁："),s("a",{attrs:{href:"https://blog.csdn.net/jam_yin/article/details/155359238#:~:text=Arthas%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E6%9C%AC%E8%B4%A8%E6%98%AF%E2%80%9CAttach%E6%9C%BA%E5%88%B6%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%90%86%20%2B%20Instrumentation%E5%AE%9E%E7%8E%B0%E5%AD%97%E8%8A%82%E7%A0%81%E5%A2%9E%E5%BC%BA%E2%80%9D%E7%9A%84%E7%BB%84%E5%90%88%EF%BC%8C%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B%E5%A6%82%E4%B8%8B%EF%BC%9A%204.,Arthas%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90%20Arthas%E9%87%87%E7%94%A8%E2%80%9C%E5%AE%A2%E6%88%B7%E7%AB%AF-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E2%80%9D%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%88%86%E4%B8%BA%E4%B8%89%E5%A4%A7%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97%EF%BC%9A%E5%AE%A2%E6%88%B7%E7%AB%AF%E3%80%81%E6%9C%8D%E5%8A%A1%E7%AB%AF%E3%80%81%E4%BB%A3%E7%90%86%E7%AB%AF%EF%BC%8C%E5%90%84%E6%A8%A1%E5%9D%97%E8%81%8C%E8%B4%A3%E6%B8%85%E6%99%B0%EF%BC%8C%E5%8D%8F%E5%90%8C%E5%B7%A5%E4%BD%9C%E5%AE%9E%E7%8E%B0%E8%AF%8A%E6%96%AD%E5%8A%9F%E8%83%BD%E3%80%82%20%E6%94%AF%E6%8C%81%E5%91%BD%E4%BB%A4%E8%A1%A5%E5%85%A8%E3%80%81%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95%E3%80%81%E7%BB%93%E6%9E%9C%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B1%95%E7%A4%BA%E3%80%82%20%E5%B0%86%E9%87%87%E9%9B%86%E5%88%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%90%8E%E8%BF%94%E5%9B%9E%E5%AE%A2%E6%88%B7%E7%AB%AF%E3%80%82%20%E6%94%AF%E6%8C%81%E7%B1%BB%E9%87%8D%E5%AE%9A%E4%B9%89%E3%80%81%E7%B1%BB%E5%8D%B8%E8%BD%BD%E7%AD%89%E6%A0%B8%E5%BF%83%E6%93%8D%E4%BD%9C%E3%80%82",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://blog.csdn.net/jam_yin/article/details/155359238#:~:text=Arthas的工作原理本质是“Attach机制注入代理 %2B Instrumentation实现字节码增强”的组合，整体流程如下： 4.,Arthas核心架构解析 Arthas采用“客户端-服务端”架构，分为三大核心模块：客户端、服务端、代理端，各模块职责清晰，协同工作实现诊断功能。 支持命令补全、历史记录、结果格式化展示。 将采集到的数据格式化后返回客户端。 支持类重定义、类卸载等核心操作。"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("项目启动报错：Redis health check failed:"),s("a",{attrs:{href:"https://www.cnblogs.com/yl97/p/14926029.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.cnblogs.com/yl97/p/14926029.html"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("Tunnel Server:"),s("a",{attrs:{href:"https://www.xiehai.zone/arthas/install/tunnel.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.xiehai.zone/arthas/install/tunnel.html"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("《运维监控系统实战笔记》")]),t._v(" "),s("p",[t._v("实战开发 arthas-spring-boot-starter，监控你的微服务是否健康!："),s("a",{attrs:{href:"https://xie.infoq.cn/article/847786de8b6da553db8b018ce",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://xie.infoq.cn/article/847786de8b6da553db8b018ce"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("一文带你整合arthas和springboot\n:"),s("a",{attrs:{href:"https://blog.csdn.net/weixin_45642975/article/details/148202414",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://blog.csdn.net/weixin_45642975/article/details/148202414"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("spring boot 集成arthas实现线上远程监控调优\n:"),s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/610030983",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://zhuanlan.zhihu.com/p/610030983"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("Arthas Tunnel:"),s("a",{attrs:{href:"https://arthas.aliyun.com/doc/tunnel.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://arthas.aliyun.com/doc/tunnel.html"),s("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);